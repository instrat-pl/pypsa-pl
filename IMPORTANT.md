The effect of this commit https://github.com/PyPSA/PyPSA/pull/652/commits/067484eebcfc00e62b6630d80fcd114656738d3d has been manually applied to the local installation of pypsa 0.23.0.

Update to pypsa 0.24.0 leads to bugs in the output.